# k3s server configuration
# Generated by Ansible

# Cluster configuration
{% if k3s_control_plane_cluster_init %}
cluster-init: {{ k3s_control_plane_cluster_init | lower }}
{% endif %}
{% if k3s_control_plane_endpoint %}
server: https://{{ k3s_control_plane_endpoint }}:6443
{% endif %}
{% if k3s_control_plane_token %}
token: {{ k3s_control_plane_token }}
{% endif %}

# Data directory
data-dir: {{ k3s_common_data_dir }}

# Network configuration
cluster-cidr: {{ k3s_common_cluster_cidr }}
service-cidr: {{ k3s_common_service_cidr }}
cluster-dns: {{ k3s_common_cluster_dns }}

# Disable default components
{% for component in k3s_control_plane_disable_components %}
disable: {{ component }}
{% endfor %}

# TLS configuration
{% if k3s_control_plane_tls_san %}
tls-san:
{% for san in k3s_control_plane_tls_san %}
  - {{ san }}
{% endfor %}
{% endif %}

# Node configuration
{% if k3s_control_plane_node_labels %}
node-label:
{% for key, value in k3s_control_plane_node_labels.items() %}
  - {{ key }}={{ value }}
{% endfor %}
{% endif %}

{% if k3s_control_plane_node_taints %}
node-taint:
{% for taint in k3s_control_plane_node_taints %}
  - {{ taint }}
{% endfor %}
{% endif %}

# ETCD snapshot configuration
etcd-snapshot-schedule-cron: {{ k3s_control_plane_etcd_snapshot_schedule }}
etcd-snapshot-retention: {{ k3s_control_plane_etcd_snapshot_retention }}

# Security
protect-kernel-defaults: true

# Logging
log: /var/log/k3s.log
